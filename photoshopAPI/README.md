# Standard

Для использования интерфейса фотошопа в плагинах используем динамически подгружаемые библиотеки с реализацией API.

> [!IMPORTANT]
> Все API должно находится в динамически подгружаемой библиотеке libapi_photoshop.dll/.so/.dylib

Эта библиотека должна находится в одной директории с исполняемым файлом.

## Options Bar

В это Bar можно добавлять опции для работы с фотошопом, такие как фильтры, справка, открытие файлов и т. д. Можно создавать новые опции, либо добавлять функционал для уже существующих. Фотошоп должен предоставлять следующие стандартные опции: фильтры, работа с файлами, работа со слоями, справка, инструменты. Id для этих опций находятся в файле `api_bar.hpp`.

## Формат плагинов

Подключение api фотошопа должно иметь вид:
```C++
#include "api/..."
```

Все остальные подключения при размещении плагина и всего с ним связанного в одной директории должны работать.

Для совместимости в директории с исполняемым файлом должна быть папка `assets` с изображениями необходимыми для плагинов.

## Порядок отрисовки

Окна в рисуются в следующем порядке:
- `Canvas`
- `ToolBar`
- `InstrumentsBar` (может перерисовываться по мере необходимости, а не каждый раз)
- все остальные окна
- `OptionsBar`

Для любого бара сначала рисуется сам бар, потом рисуется бар, открытый одной из кнопок, и так далее рекурсивно.

Слои в `ICanvas` рисуются в порядке увеличения их индексов. Временный слой рисуется последним.

- Поведение при рисовании детей должно быть таким, как будто родитель каждый раз выставляет им размер и позицию.
- дети `IWindowContainer` должны всегда рисоваться и обновляться в одном и том же порядке

## Смешивание цветов

> [!IMPORTANT]
> Запрещено использовать свою реализацию смешивания цветов вместо стандартной.

## Инструменты для кнопок

Инструменты добавляются в `IInstrumentBar` при помощи `addWindow`.
Для добавления инструмента выбора цвета, толщины и прозрачности нужно добавлять классы `IColorPalette`, `IOpacityBar`, `IThicknessBar`. Заменять их запрещается. `InstrumentBar` по id определяет, что добавлен стандартные класс и ставит их на фиксированные места при помощи `setSize`, `setPos`.
При деактивации кнопки она обязана вызвать функцию `removeAllInstruments`.


## Адресация по `Canvas`


Функции `getMousePos`, `setPixel`, `getPixel` у `Canvas` адресуется по пикселям относительно левого верхнего угла сектора, в котором находится `Canvas` на экране. (Положение этого угла можно получить при помощи функции `getCanvasIntRect`). Если функция `setPixel` получает индекс пикселя, который выходит за границу, то функция ничего не делает. В аналогичной ситуации `getPixel` возвращает цвет `Color(0, 0, 0, 0)`.
